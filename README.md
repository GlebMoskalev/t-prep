# T-Prep Backend

Backend API –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è T-Prep - —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ —ç–∫–∑–∞–º–µ–Ω–∞–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–µ—Ç–æ–¥–∏–∫–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google OAuth 2.0
- üé´ JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- üìö –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è–º–∏ –∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
- üß† –ê–ª–≥–æ—Ä–∏—Ç–º –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π (SFRS)
- üê≥ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- üìä PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
app/
‚îú‚îÄ‚îÄ api/                    # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ v1/                # API –≤–µ—Ä—Å–∏–∏ 1
‚îÇ   ‚îî‚îÄ‚îÄ endpoints/         # –û—Ç–¥–µ–ª—å–Ω—ã–µ endpoints
‚îú‚îÄ‚îÄ core/                  # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config.py         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ security.py       # JWT –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚îÇ   ‚îî‚îÄ‚îÄ deps.py           # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ db/                    # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ database.py       # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îú‚îÄ‚îÄ models/                # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ user.py           # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ module.py         # –ú–æ–¥–µ–ª—å –º–æ–¥—É–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ card.py           # –ú–æ–¥–µ–ª—å –∫–∞—Ä—Ç–æ—á–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ interval_repetition.py  # –ò–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ module_access.py  # –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
‚îú‚îÄ‚îÄ schemas/               # Pydantic —Å—Ö–µ–º—ã
‚îú‚îÄ‚îÄ services/              # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ auth_service.py   # –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ google_oauth_service.py  # Google OAuth
‚îî‚îÄ‚îÄ utils/                 # –£—Ç–∏–ª–∏—Ç—ã
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone <repository-url>
cd t-prep
```

2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate     # Windows
```

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

4. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `env.example`:
```bash
cp env.example .env
```

5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`:
```env
DATABASE_URL=postgresql://tprep_user:tprep_password@localhost:5432/tprep_db
SECRET_KEY=your-secret-key-here
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
```

6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
uvicorn main:app --reload
```

### Docker

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã:
```bash
docker-compose up -d
```

2. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000

## API Endpoints

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `GET /api/v1/auth/google` - –ü–æ–ª—É—á–∏—Ç—å URL –¥–ª—è Google OAuth
- `POST /api/v1/auth/google/callback` - –û–±—Ä–∞–±–æ—Ç–∫–∞ callback –æ—Ç Google
- `GET /api/v1/auth/me` - –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- `POST /api/v1/auth/logout` - –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

### –ú–æ–¥—É–ª–∏
- `GET /api/v1/modules/` - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –º–æ–¥—É–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/v1/modules/` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å
- `GET /api/v1/modules/{module_id}` - –ü–æ–ª—É—á–∏—Ç—å –º–æ–¥—É–ª—å –ø–æ ID
- `PUT /api/v1/modules/{module_id}` - –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥—É–ª—å
- `DELETE /api/v1/modules/{module_id}` - –£–¥–∞–ª–∏—Ç—å –º–æ–¥—É–ª—å

### –ö–∞—Ä—Ç–æ—á–∫–∏
- `GET /api/v1/cards/module/{module_id}` - –ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ –º–æ–¥—É–ª—è
- `POST /api/v1/cards/` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É
- `GET /api/v1/cards/{card_id}` - –ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ ID
- `PUT /api/v1/cards/{card_id}` - –û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É
- `DELETE /api/v1/cards/{card_id}` - –£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `GET /api/v1/users/me` - –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `PUT /api/v1/users/me` - –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google OAuth

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Cloud Console](https://console.cloud.google.com/)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
3. –í–∫–ª—é—á–∏—Ç–µ Google+ API
4. –°–æ–∑–¥–∞–π—Ç–µ OAuth 2.0 credentials
5. –î–æ–±–∞–≤—å—Ç–µ redirect URI: `http://localhost:8000/api/v1/auth/google/callback`
6. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Client ID –∏ Client Secret –≤ —Ñ–∞–π–ª `.env`

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã:
- `users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
- `modules` - –ú–æ–¥—É–ª–∏ (–Ω–∞–±–æ—Ä—ã –∫–∞—Ä—Ç–æ—á–µ–∫)
- `cards` - –ö–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è
- `interval_repetitions` - –ò–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
- `module_accesses` - –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–æ–¥—É–ª—è–º

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö endpoints:
1. –°–æ–∑–¥–∞–π—Ç–µ —Å—Ö–µ–º—É –≤ `app/schemas/`
2. –î–æ–±–∞–≤—å—Ç–µ endpoint –≤ `app/api/endpoints/`
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ `app/api/v1/api.py`

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
```bash
# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "Description"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head
```
